<%- include('partials/header') %>

<div class="player-container">
    <div class="video-section">
        <div class="video-frame" id="videoContainer">
            <video id="mainVideo" playsinline poster="<%= detail.shortPlayCover %>">
                </video>

            <div class="video-overlay" id="videoControls">
                <div class="progress-area" id="progressArea">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div class="ctrl-row">
                    <div style="display:flex; align-items:center;">
                        <button class="ctrl-btn" id="playPauseBtn"><i class="fas fa-play"></i></button>
                        <span class="time-txt"><span id="curTime">0:00</span> / <span id="durTime">0:00</span></span>
                    </div>
                    <div>
                        <button class="ctrl-btn" id="fullscreenBtn"><i class="fas fa-expand"></i></button>
                    </div>
                </div>
            </div>
            
            <div id="loadingSpinner" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); display:none;">
                <i class="fas fa-spinner fa-spin" style="font-size:3rem; color:var(--primary);"></i>
            </div>
        </div>

        <div style="width:100%; max-width:500px; padding: 15px 5px;">
            <h1 style="font-size:1.5rem;"><%= detail.shortPlayName %></h1>
            <p style="color:var(--text-gray); font-size:0.9rem; margin-top:5px;"><%= detail.totalEpisode %> Episodes â€¢ Trending</p>
        </div>
    </div>

    <div class="playlist-section">
        <div class="playlist-header">
            <h3>Episodes</h3>
        </div>
        <div class="playlist-body">
            <% if(detail.shortPlayEpisodeInfos) { %>
                <% detail.shortPlayEpisodeInfos.forEach(ep => { %>
                    <div class="episode-item" 
                         data-src="<%= ep.playVoucher %>" 
                         data-id="<%= ep.episodeId %>"
                         data-no="<%= ep.episodeNo %>"
                         onclick="playEpisode(this)">
                        
                        <img src="<%= ep.episodeCover || detail.shortPlayCover %>" class="ep-thumb" loading="lazy">
                        
                        <div class="ep-info">
                            <span class="ep-num">Episode <%= ep.episodeNo %></span>
                            <span class="ep-dur"><%= ep.playClarity || 'HD' %></span>
                            <% if(ep.isLock) { %> <i class="fas fa-lock" style="font-size:10px; margin-top:5px;"></i> <% } %>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>
</div>

<script>
    const PLAYLIST = <%- JSON.stringify(detail.shortPlayEpisodeInfos || []) %>;
    const SERIES_ID = "<%= detail.shortPlayId %>";
</script>

<%- include('partials/footer') %>
